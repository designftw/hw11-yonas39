<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Let's Chat</title>
    <link rel="stylesheet" href="style_1.css" />
    <link rel="stylesheet" href="style_2.css" />

    <script type="module" src="chat_1.js"></script>
  </head>
  <body>
    <!-- ############### Title #################################-->
    <!-- ############### Title #################################-->
    <h1>Let's Chat</h1>

    <!-- ############### App #################################-->
    <!-- ############### App #################################-->
    <div id="app">
      <!-- ############### Setting, Edit-profile, New Message  #################################-->
      <!-- ############### Setting, Edit-profile, New Message  #################################-->
      <div class="top-buttons">
        <button class="setting-btn">Setting</button>
        <button class="edit-btn">Edit</button>
        <button class="new-message-btn">New-Message</button>
      </div>
      <!-- ############### Help  #################################-->
      <!-- ############### Help #################################-->
      <div class="help-button-container">
        <button @click="toggleHelpModal" class="help-button">Help</button>
      </div>

      <transition name="help-modal">
        <div class="help-modal" v-if="showHelpModal">
          >
          <!-- <h2>Help</h2> -->
          <!-- <p>Explanation of features and functionality here...</p> -->
          <p>
            <strong>How to use the chat app:</strong>
          </p>
          <ul>
            <li>Click the "Log In" button to log in or out.</li>
            <li>
              Choose between "Public chat" and "Private Messaging" by clicking
              the respective buttons.
            </li>
            <li>
              For public chat, enter the channel name you want to chat in. For
              private messaging, enter the Actor ID of the person you want to
              chat with.
            </li>
            <li>
              Type your message in the input field and click "Send" to send the
              message.
            </li>
            <li>
              Click "Edit Message" or "Delete Message" to edit or delete your
              messages.
            </li>
            <li>Click "Edit Name" to change your display name.</li>
          </ul>
          <button @click="toggleHelpModal" class="close-help-button">
            Close
          </button>
        </div>
      </transition>

      <!-- ############### Login and LogOut #################################-->
      <!-- ############### Login and LogOut #################################-->
      <p>
        <button class="login-logout" @click="$gf.toggleLogIn">
          <!-- If we have a user ID, we're logged in so show "Log Out" -->
          <!-- Otherwise, show "Log In" -->
          {{ $gf.me? 'Log Out' : 'Log In' }}
        </button>
      </p>

      <!-- ############### Logged in Properties #################################-->
      <!-- ############### Logged in Properties #################################-->
      <!-- If we're not logged in, hide everything except the login button -->

      <template v-if="$gf.me">
        <!-- ############### Display Name #################################-->
        <!-- ############### Display Name #################################-->
        <div>
          <img
            class="profile-image"
            src="image_1222.png"
            alt="User profile image"
          />
        </div>
        <div class="profile-name">
          <p>
            <!-- We display names in multiple places, so we made a -->
            <!-- reusable <name></name> component. -->
            <!-- See below for the template. -->
            Name: <name :actor="$gf.me" :editable="true"></name>
          </p>
        </div>

        <!-- ############### Request Username #################################-->
        <!-- ############### Request Username #################################-->
        <!-- ############### Request Username #################################-->
        <div class="request-username">
          <p>Request Username :</p>
          <form @submit.prevent="requestUsername">
            <input
              placeholder="Type the Username..."
              v-model="requestedUsername"
            />
            <input class="button" type="submit" value="Request" />
            <span class="success" v-if="usernameSuccess"
              >{{usernameSuccess}}</span
            >
          </form>

          <span class="error" v-if="usernameError">{{usernameError}}</span>
          <!-- </p> -->
        </div>
        <!-- ############### Chat format PUBLIC / PRIVATE ##############################-->
        <!-- ############### Chat format PUBLIC / PRIVATE ##############################-->
        <!-- ############### Chat format PUBLIC / PRIVATE ##############################-->
        <p>
          Change chat format:
          <input
            type="radio"
            id="channel"
            :value="false"
            v-model="privateMessaging"
          />
          <label for="channel">Channel-based public chat</label>

          <input
            type="radio"
            id="pm"
            :value="true"
            v-model="privateMessaging"
          />
          <label for="pm">Private Messaging</label>

          <!-- ###################### the number of unread messages ################# -->
          <!-- <span class="unread-messages" v-if="unreadMessages">
            ({{ unreadMessages }} new message{{ unreadMessages > 1 ? 's' : '' }})
          </span> -->
        </p>

        <!--  -->
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->
        <div class="chat-indicator">
          <!-- <span class="new-messages-count" v-if="newMessagesCount > 0">{{ newMessagesCount }}</span> -->
          <span class="new-messages-count" v-if="newMessagesCount > 0">
            ({{ newMessagesCount }} new message{{ newMessagesCount > 1 ? 's' :
            '' }})
          </span>
          <!-- Your chat icon or chat title here -->
        </div>
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->
        <!-- $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ -->

        <p v-if="!privateMessaging" class="channel-base">
          <label for="channel"> Change the channel you're chatting in: </label>
          <input id="channel" v-model="channel" />
        </p>

        <!-- ############### Search by username  ##############################-->
        <!-- ############### Search by username  ##############################-->
        <p v-else>
          <label for="username">Search by Username:</label>
          <input id="username" v-model="searchedUsername" />
          <button @click="searchByUsername">Search</button>
          <span class="search-status" v-if="searchError"
            >{{ searchError }}</span
          >
          <span v-if="searchLoading">Loading...</span>
        </p>

        <!-- ############### Auto Complete ##############################-->
        <!-- ############### Auto Complete ##############################-->
        <div class="autocomplete-container" v-if="searchedUsername">
          <ul>
            <li
              v-for="suggestedUsername in filteredUsernames"
              @click="selectSuggestedUsername(suggestedUsername)"
            >
              {{suggestedUsername}}
            </li>
          </ul>
        </div>
        <!-- <p v-else>
          <label for="recipient">
            Paste the Actor ID of who you'd like to chat with:
          </label>
          <input id="recipient" v-model="recipient" />
        </p> -->

        <!-- ############### a form to send message ##############################-->
        <!-- ############### a form to send message ##############################-->
        <!-- A form for sending messages -->
        <form @submit.prevent="sendMessage" class="send-button">
          <input v-model="messageText" placeholder="Type a message..." />
          <input class="button" type="submit" value="Send" />
        </form>

        <!-- ############### Error when sending message ##############################-->
        <!-- ############### Error when sending message ##############################-->
        <div class="error-message" v-if="errorMessage">{{ errorMessage }}</div>

        <ul class="messages-container">
          <!-- List all the messages -->
          <li v-for="message of messages" :key="message.id" class="message">
            <div class="message-info">
              <img
                class="message-avatar"
                src="image_1222.png"
                alt="User profile image"
              />
              <span class="message-from-name">
                <name :actor="message.actor"></name>
                <span v-if="fetchUsername(message.actor)"
                  >(@lc {{fetchUsername(message.actor)}})
                </span>
              </span>
              <span class="message-time">{{ message.published }}</span>
            </div>
            <div class="message-content">
              <p>{{ message.content }}</p>
              <div class="message-actions">
                <template v-if="message.actor==$gf.me">
                  <button @click="removeMessage(message)" class="action-button">
                    Delete
                  </button>
                  <button
                    @click="startEditMessage(message)"
                    class="action-button"
                  >
                    Edit
                  </button>
                </template>
              </div>
            </div>
          </li>
        </ul>
      </template>
    </div>

    <template id="name">
      <span v-if="!editing">
        <!-- If we're not editing the name-->
        <!-- Display the profile's name, if it exists -->
        <!-- or anonymous if it doesn't -->
        {{ profile? profile.name : 'Anonymous' }}

        <!-- Also if the name is "editable" add an edit button -->
        <button v-if="editable" @click="editName">Edit Name</button>
      </span>

      <!-- If we're in the editing state, create something to edit the name-->
      <form v-else @submit.prevent="saveName">
        <input v-model="editText" />
        <input type="submit" value="Save Name" />
      </form>
    </template>
  </body>
</html>
